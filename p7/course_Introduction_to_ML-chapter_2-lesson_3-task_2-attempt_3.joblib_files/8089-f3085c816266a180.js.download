"use strict";(self.webpackChunkcircle=self.webpackChunkcircle||[]).push([["8089"],{29656:function(e,t,i){i.d(t,{Z:()=>tv});var s=i(59905);class r{constructor(e,t){this.uppy=e,this.opts=null!=t?t:{}}getPluginState(){let{plugins:e}=this.uppy.getState();return(null==e?void 0:e[this.id])||{}}setPluginState(e){let{plugins:t}=this.uppy.getState();this.uppy.setState({plugins:{...t,[this.id]:{...t[this.id],...e}}})}setOptions(e){this.opts={...this.opts,...e},this.setPluginState(void 0),this.i18nInit()}i18nInit(){let e=new s.Z([this.defaultLocale,this.uppy.locale,this.opts.locale]);this.i18n=e.translate.bind(e),this.i18nArray=e.translateArray.bind(e),this.setPluginState(void 0)}addTarget(e){throw Error("Extend the addTarget method to add your plugin to another plugin's target")}install(){}uninstall(){}update(e){}afterUpdate(){}}let o=class extends Error{constructor(){super(...arguments),this.name="UserFacingApiError"}};var a=i(40743);let l=class extends Error{constructor(e,t){void 0===t&&(t=null),super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=e,this.isNetworkError=!0,this.request=t}};function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}let u=class extends Error{constructor(e,t){super(e),this.cause=null==t?void 0:t.cause,this.cause&&n(this.cause,"isNetworkError")?this.isNetworkError=this.cause.isNetworkError:this.isNetworkError=!1}},d=class extends Error{constructor(){super("Authorization required"),this.name="AuthError",this.isAuthError=!0}};function h(e,t){if(!({}).hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var p=0;function c(e){return"__private_"+p+++"_"+e}class f extends Error{constructor(e){let{statusCode:t,message:i}=e;super(i),this.name="HttpError",this.statusCode=t}}async function g(e){let t;if(401===e.status)throw new d;if(e.ok)return e.json();let i=`Failed request with status: ${e.status}. ${e.statusText}`;try{(t=await e.json()).message&&(i=`${i} message: ${t.message}`),t.requestId&&(i=`${i} request-Id: ${t.requestId}`)}catch(e){throw Error(i,{cause:e})}if(e.status>=400&&e.status<=499&&t.message)throw new o(t.message);throw new f({statusCode:e.status,message:i})}var m=c("companionHeaders"),y=c("getUrl"),v=c("requestSocketToken"),b=c("awaitRemoteFileUpload");class w{constructor(e,t){Object.defineProperty(this,b,{value:S}),Object.defineProperty(this,y,{value:P}),Object.defineProperty(this,m,{writable:!0,value:void 0}),Object.defineProperty(this,v,{writable:!0,value:async e=>{var t;let{file:i,postBody:s,signal:r}=e;if((null==(t=i.remote)?void 0:t.url)==null)throw Error("Cannot connect to an undefined URL");return(await this.post(i.remote.url,{...i.remote.body,...s},{signal:r})).token}}),this.uppy=e,this.opts=t,this.onReceiveResponse=this.onReceiveResponse.bind(this),h(this,m)[m]=t.companionHeaders}setCompanionHeaders(e){h(this,m)[m]=e}[Symbol.for("uppy test: getCompanionHeaders")](){return h(this,m)[m]}get hostname(){let{companion:e}=this.uppy.getState(),t=this.opts.companionUrl;return(e&&e[t]?e[t]:t).replace(/\/$/,"")}async headers(e){return void 0===e&&(e=!1),{Accept:"application/json",...e?void 0:{"Content-Type":"application/json"},...h(this,m)[m]}}onReceiveResponse(e){let{headers:t}=e,i=this.uppy.getState().companion||{},s=this.opts.companionUrl;t.has("i-am")&&t.get("i-am")!==i[s]&&this.uppy.setState({companion:{...i,[s]:t.get("i-am")}})}async request(e){let{path:t,method:i="GET",data:s,skipPostResponse:r,signal:o}=e;try{let e=await this.headers(!s),a=await function(){return fetch(...arguments).catch(e=>{if("AbortError"===e.name)throw e;throw new l(e)})}(h(this,y)[y](t),{method:i,signal:o,headers:e,credentials:this.opts.companionCookiesRule||"same-origin",body:s?JSON.stringify(s):null});return r||this.onReceiveResponse(a),await g(a)}catch(e){if(e.isAuthError||"UserFacingApiError"===e.name||"AbortError"===e.name)throw e;throw new u(`Could not ${i} ${h(this,y)[y](t)}`,{cause:e})}}async get(e,t){return this.request({...t,path:e})}async post(e,t,i){return this.request({...i,path:e,method:"POST",data:t})}async delete(e,t,i){return this.request({...i,path:e,method:"DELETE",data:t})}async uploadRemoteFile(e,t,i){var s=this;try{let{signal:r,getQueue:o}=i||{};return await (0,a.Z)(async()=>{var i;let l=null==(i=this.uppy.getFile(e.id))?void 0:i.serverToken;if(null!=l)return this.uppy.log(`Connecting to exiting websocket ${l}`),h(this,b)[b]({file:e,queue:o(),signal:r});let n=o().wrapPromiseFunction(async function(){try{return await h(s,v)[v](...arguments)}catch(t){if(t.isAuthError)throw new a._(t);if(null==t.cause)throw t;let e=t.cause;if("HttpError"===e.name&&!([408,409,429,418,423].includes(e.statusCode)||e.statusCode>=500&&e.statusCode<=599&&![501,505].includes(e.statusCode)))throw new a._(e);throw e}},{priority:-1}),u=await n({file:e,postBody:t,signal:r}).abortOn(r);if(this.uppy.getFile(e.id))return this.uppy.setFileState(e.id,{serverToken:u}),h(this,b)[b]({file:this.uppy.getFile(e.id),queue:o(),signal:r})},{retries:10,signal:r,onFailedAttempt:e=>this.uppy.log(`Retrying upload due to: ${e.message}`,"warning")})}catch(t){if("AbortError"===t.name)return;throw this.uppy.emit("upload-error",e,t),t}}}function P(e){return/^(https?:|)\/\//.test(e)?e:`${this.hostname}/${e}`}async function S(e){let t,{file:i,queue:s,signal:r}=e,{capabilities:o}=this.uppy.getState();try{return await new Promise((e,l)=>{let n,u,d,h=i.serverToken,p=function(e){var t;let i=null==(t=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?([^\n]+)/i.exec(e))?void 0:t[1],s=/^http:\/\//i.test(e)?"ws":"wss";return`${s}://${i}`}(i.remote.companionUrl),{isPaused:c}=i,f=(e,t)=>{if(null==n||n.readyState!==n.OPEN){var s;this.uppy.log(`Cannot send "${e}" to socket ${i.id} because the socket state was ${String(null==(s=n)?void 0:s.readyState)}`,"warning");return}n.send(JSON.stringify({action:e,payload:null!=t?t:{}}))};function g(){o.resumableUploads&&(c?f("pause"):f("resume"))}let m=async()=>{u&&u.abort(),u=new AbortController;let t=e=>{var t;this.uppy.setFileState(i.id,{serverToken:null}),null==(t=u)||null==t.abort||t.abort(),l(e)};function r(){clearTimeout(d),c||(d=setTimeout(()=>t(Error("Timeout waiting for message from Companion socket")),3e5))}try{await s.wrapPromiseFunction(async()=>{let s=async()=>new Promise((s,o)=>{n=new WebSocket(`${p}/api/${h}`),r(),n.addEventListener("close",()=>{n=void 0,o(Error("Socket closed unexpectedly"))}),n.addEventListener("error",e=>{var t;this.uppy.log(`Companion socket error ${JSON.stringify(e)}, closing socket`,"warning"),null==(t=n)||t.close()}),n.addEventListener("open",()=>{g()}),n.addEventListener("message",s=>{r();try{let{action:t,payload:r}=JSON.parse(s.data);switch(t){case"progress":!function(e,t,i){let{progress:s,bytesUploaded:r,bytesTotal:o}=t;if(s){var a;e.uppy.log(`Upload progress: ${s}`),e.uppy.emit("upload-progress",i,{uploadStarted:null!=(a=i.progress.uploadStarted)?a:0,bytesUploaded:r,bytesTotal:o})}}(this,r,this.uppy.getFile(i.id));break;case"success":{var o,a,l,n;let t=null==(o=r.response)?void 0:o.responseText;this.uppy.emit("upload-success",this.uppy.getFile(i.id),{uploadURL:r.url,status:null!=(a=null==(l=r.response)?void 0:l.status)?a:200,body:t?JSON.parse(t):void 0}),null==(n=u)||null==n.abort||n.abort(),e();break}case"error":{let{message:e}=r.error;throw Object.assign(Error(e),{cause:r.error})}default:this.uppy.log(`Companion socket unknown action ${t}`,"warning")}}catch(e){t(e)}});let a=()=>{this.uppy.log(`Closing socket ${i.id}`),clearTimeout(d),n&&n.close(),n=void 0};u.signal.addEventListener("abort",()=>{a()})});await (0,a.Z)(s,{retries:10,signal:u.signal,onFailedAttempt:()=>{u.signal.aborted||this.uppy.log(`Retrying websocket ${i.id}`)}})})().abortOn(u.signal)}catch(e){if(u.signal.aborted)return;t(e)}},y=e=>{o.resumableUploads&&(c=e,n&&g())},v=t=>{var s;o.individualCancellation&&t.id===i.id&&(f("cancel"),null==(s=u)||null==s.abort||s.abort(),this.uppy.log(`upload ${i.id} was removed`),e())},b=()=>{var t;f("cancel"),null==(t=u)||null==t.abort||t.abort(),this.uppy.log(`upload ${i.id} was canceled`),e()},w=(e,t)=>{(null==e?void 0:e.id)===i.id&&y(t)},P=()=>y(!0),S=()=>y(!1);this.uppy.on("file-removed",v),this.uppy.on("cancel-all",b),this.uppy.on("upload-pause",w),this.uppy.on("pause-all",P),this.uppy.on("resume-all",S),t=()=>{this.uppy.off("file-removed",v),this.uppy.off("cancel-all",b),this.uppy.off("upload-pause",w),this.uppy.off("pause-all",P),this.uppy.off("resume-all",S)},r.addEventListener("abort",()=>{var e;null==(e=u)||e.abort()}),m()})}finally{null==t||t()}}w.VERSION="4.4.2";function O(e,t){if(!({}).hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var F=0;function U(e){return"__private_"+F+++"_"+e}var j=U("uppy"),E=U("events");class C{constructor(e){Object.defineProperty(this,j,{writable:!0,value:void 0}),Object.defineProperty(this,E,{writable:!0,value:[]}),O(this,j)[j]=e}on(e,t){return O(this,E)[E].push([e,t]),O(this,j)[j].on(e,t)}remove(){for(let[e,t]of O(this,E)[E].splice(0))O(this,j)[j].off(e,t)}onFilePause(e,t){this.on("upload-pause",(i,s)=>{e===(null==i?void 0:i.id)&&t(s)})}onFileRemove(e,t){this.on("file-removed",i=>{e===i.id&&t(i.id)})}onPause(e,t){this.on("upload-pause",(i,s)=>{e===(null==i?void 0:i.id)&&t(s)})}onRetry(e,t){this.on("upload-retry",i=>{e===(null==i?void 0:i.id)&&t()})}onRetryAll(e,t){this.on("retry-all",()=>{O(this,j)[j].getFile(e)&&t()})}onPauseAll(e,t){this.on("pause-all",()=>{O(this,j)[j].getFile(e)&&t()})}onCancelAll(e,t){var i=this;this.on("cancel-all",function(){O(i,j)[j].getFile(e)&&t(...arguments)})}onResumeAll(e,t){this.on("resume-all",()=>{O(this,j)[j].getFile(e)&&t()})}}function A(e,t){if(!({}).hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var k=0;function R(e){return"__private_"+k+++"_"+e}function x(e){if(null!=e){var t;let i=()=>this.abort(e.reason);e.addEventListener("abort",i,{once:!0});let s=()=>{e.removeEventListener("abort",i)};null==(t=this.then)||t.call(this,s,s)}return this}var T=R("activeRequests"),$=R("queuedHandlers"),M=R("paused"),I=R("pauseTimer"),z=R("downLimit"),_=R("upperLimit"),L=R("rateLimitingTimer"),N=R("call"),q=R("queueNext"),D=R("next"),H=R("queue"),B=R("dequeue"),X=R("resume"),G=R("increaseLimit");class W{constructor(e){Object.defineProperty(this,B,{value:J}),Object.defineProperty(this,H,{value:K}),Object.defineProperty(this,D,{value:V}),Object.defineProperty(this,q,{value:Z}),Object.defineProperty(this,N,{value:Y}),Object.defineProperty(this,T,{writable:!0,value:0}),Object.defineProperty(this,$,{writable:!0,value:[]}),Object.defineProperty(this,M,{writable:!0,value:!1}),Object.defineProperty(this,I,{writable:!0,value:void 0}),Object.defineProperty(this,z,{writable:!0,value:1}),Object.defineProperty(this,_,{writable:!0,value:void 0}),Object.defineProperty(this,L,{writable:!0,value:void 0}),Object.defineProperty(this,X,{writable:!0,value:()=>this.resume()}),Object.defineProperty(this,G,{writable:!0,value:()=>{if(A(this,M)[M]){A(this,L)[L]=setTimeout(A(this,G)[G],0);return}A(this,z)[z]=this.limit,this.limit=Math.ceil((A(this,_)[_]+A(this,z)[z])/2);for(let e=A(this,z)[z];e<=this.limit;e++)A(this,q)[q]();A(this,_)[_]-A(this,z)[z]>3?A(this,L)[L]=setTimeout(A(this,G)[G],2e3):A(this,z)[z]=Math.floor(A(this,z)[z]/2)}}),"number"!=typeof e||0===e?this.limit=1/0:this.limit=e}run(e,t){return!A(this,M)[M]&&A(this,T)[T]<this.limit?A(this,N)[N](e):A(this,H)[H](e,t)}wrapSyncFunction(e,t){var i=this;return function(){for(var s=arguments.length,r=Array(s),o=0;o<s;o++)r[o]=arguments[o];let a=i.run(()=>(e(...r),queueMicrotask(()=>a.done()),()=>{}),t);return{abortOn:x,abort(){a.abort()}}}}wrapPromiseFunction(e,t){var i=this;return function(){let s;for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];let l=new Promise((r,a)=>{s=i.run(()=>{let t,i;try{i=Promise.resolve(e(...o))}catch(e){i=Promise.reject(e)}return i.then(e=>{t?a(t):(s.done(),r(e))},e=>{t?a(t):(s.done(),a(e))}),e=>{t=Error("Cancelled",{cause:e})}},t)});return l.abort=e=>{s.abort(e)},l.abortOn=x,l}}resume(){A(this,M)[M]=!1,clearTimeout(A(this,I)[I]);for(let e=0;e<this.limit;e++)A(this,q)[q]()}pause(e){void 0===e&&(e=null),A(this,M)[M]=!0,clearTimeout(A(this,I)[I]),null!=e&&(A(this,I)[I]=setTimeout(A(this,X)[X],e))}rateLimit(e){clearTimeout(A(this,L)[L]),this.pause(e),this.limit>1&&Number.isFinite(this.limit)&&(A(this,_)[_]=this.limit-1,this.limit=A(this,z)[z],A(this,L)[L]=setTimeout(A(this,G)[G],e))}get isPaused(){return A(this,M)[M]}}function Y(e){let t;A(this,T)[T]+=1;let i=!1;try{t=e()}catch(e){throw A(this,T)[T]-=1,e}return{abort:e=>{i||(i=!0,A(this,T)[T]-=1,null==t||t(e),A(this,q)[q]())},done:()=>{i||(i=!0,A(this,T)[T]-=1,A(this,q)[q]())}}}function Z(){queueMicrotask(()=>A(this,D)[D]())}function V(){if(A(this,M)[M]||A(this,T)[T]>=this.limit||0===A(this,$)[$].length)return;let e=A(this,$)[$].shift();if(null==e)throw Error("Invariant violation: next is null");let t=A(this,N)[N](e.fn);e.abort=t.abort,e.done=t.done}function K(e,t){let i={fn:e,priority:(null==t?void 0:t.priority)||0,abort:()=>{A(this,B)[B](i)},done:()=>{throw Error("Cannot mark a queued request as done: this indicates a bug")}},s=A(this,$)[$].findIndex(e=>i.priority>e.priority);return -1===s?A(this,$)[$].push(i):A(this,$)[$].splice(s,0,i),i}function J(e){let t=A(this,$)[$].indexOf(e);-1!==t&&A(this,$)[$].splice(t,1)}Symbol("__queue");let{AbortController:Q}=globalThis,{AbortSignal:ee}=globalThis,et=function(e,t){void 0===e&&(e="Aborted");let i=new DOMException(e,"AbortError");return null!=t&&n(t,"cause")&&Object.defineProperty(i,"cause",{__proto__:null,configurable:!0,writable:!0,value:t.cause}),i};function ei(e,t){return!0===e?Object.keys(t):Array.isArray(e)?e:[]}function es(e,t){if(!({}).hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var er=0;function eo(e){return"__private_"+er+++"_"+e}let ea={getChunkSize:e=>Math.ceil(e.size/1e4),onProgress(){},onPartComplete(){},onSuccess(){},onError(e){throw e}},el=Symbol("pausing upload, not an actual error");var en=eo("abortController"),eu=eo("chunks"),ed=eo("chunkState"),eh=eo("data"),ep=eo("file"),ec=eo("uploadHasStarted"),ef=eo("onError"),eg=eo("onSuccess"),em=eo("shouldUseMultipart"),ey=eo("isRestoring"),ev=eo("onReject"),eb=eo("maxMultipartParts"),ew=eo("minPartSize"),eP=eo("initChunks"),eS=eo("createUpload"),eO=eo("resumeUpload"),eF=eo("onPartProgress"),eU=eo("onPartComplete"),ej=eo("abortUpload");class eE{constructor(e,t){var i;Object.defineProperty(this,ej,{value:eR}),Object.defineProperty(this,eO,{value:ek}),Object.defineProperty(this,eS,{value:eA}),Object.defineProperty(this,eP,{value:eC}),Object.defineProperty(this,en,{writable:!0,value:new Q}),Object.defineProperty(this,eu,{writable:!0,value:[]}),Object.defineProperty(this,ed,{writable:!0,value:[]}),Object.defineProperty(this,eh,{writable:!0,value:void 0}),Object.defineProperty(this,ep,{writable:!0,value:void 0}),Object.defineProperty(this,ec,{writable:!0,value:!1}),Object.defineProperty(this,ef,{writable:!0,value:void 0}),Object.defineProperty(this,eg,{writable:!0,value:void 0}),Object.defineProperty(this,em,{writable:!0,value:void 0}),Object.defineProperty(this,ey,{writable:!0,value:void 0}),Object.defineProperty(this,ev,{writable:!0,value:e=>(null==e?void 0:e.cause)===el?null:es(this,ef)[ef](e)}),Object.defineProperty(this,eb,{writable:!0,value:1e4}),Object.defineProperty(this,ew,{writable:!0,value:5242880}),Object.defineProperty(this,eF,{writable:!0,value:e=>t=>{if(!t.lengthComputable)return;es(this,ed)[ed][e].uploaded=function(e){if("string"==typeof e)return parseInt(e,10);if("number"==typeof e)return e;throw TypeError("Expected a number")}(t.loaded);let i=es(this,ed)[ed].reduce((e,t)=>e+t.uploaded,0);this.options.onProgress(i,es(this,eh)[eh].size)}}),Object.defineProperty(this,eU,{writable:!0,value:e=>t=>{es(this,eu)[eu][e]=null,es(this,ed)[ed][e].etag=t,es(this,ed)[ed][e].done=!0,this.options.onPartComplete({PartNumber:e+1,ETag:t})}}),this.options={...ea,...t},null!=(i=this.options).getChunkSize||(i.getChunkSize=ea.getChunkSize),es(this,eh)[eh]=e,es(this,ep)[ep]=t.file,es(this,eg)[eg]=this.options.onSuccess,es(this,ef)[ef]=this.options.onError,es(this,em)[em]=this.options.shouldUseMultipart,es(this,ey)[ey]=t.uploadId&&t.key,es(this,eP)[eP]()}start(){es(this,ec)[ec]?(es(this,en)[en].signal.aborted||es(this,en)[en].abort(el),es(this,en)[en]=new Q,es(this,eO)[eO]()):es(this,ey)[ey]?(this.options.companionComm.restoreUploadFile(es(this,ep)[ep],{uploadId:this.options.uploadId,key:this.options.key}),es(this,eO)[eO]()):es(this,eS)[eS]()}pause(){es(this,en)[en].abort(el),es(this,en)[en]=new Q}abort(e){null!=e&&e.really?es(this,ej)[ej]():this.pause()}[Symbol.for("uppy test: getChunkState")](){return es(this,ed)[ed]}}function eC(){let e=es(this,eh)[eh].size,t="function"==typeof es(this,em)[em]?es(this,em)[em](es(this,ep)[ep]):!!es(this,em)[em];if(t&&e>es(this,ew)[ew]){let i=Math.max(this.options.getChunkSize(es(this,eh)[eh]),es(this,ew)[ew]),s=Math.floor(e/i);s>es(this,eb)[eb]&&(s=es(this,eb)[eb],i=e/es(this,eb)[eb]),es(this,eu)[eu]=Array(s);for(let s=0,r=0;s<e;s+=i,r++){let o=Math.min(e,s+i),a=()=>{let e=s;return es(this,eh)[eh].slice(e,o)};if(es(this,eu)[eu][r]={getData:a,onProgress:es(this,eF)[eF](r),onComplete:es(this,eU)[eU](r),shouldUseMultipart:t},es(this,ey)[ey]){let t=s+i>e?e-s:i;es(this,eu)[eu][r].setAsUploaded=()=>{es(this,eu)[eu][r]=null,es(this,ed)[ed][r].uploaded=t}}}}else es(this,eu)[eu]=[{getData:()=>es(this,eh)[eh],onProgress:es(this,eF)[eF](0),onComplete:es(this,eU)[eU](0),shouldUseMultipart:t}];es(this,ed)[ed]=es(this,eu)[eu].map(()=>({uploaded:0}))}function eA(){this.options.companionComm.uploadFile(es(this,ep)[ep],es(this,eu)[eu],es(this,en)[en].signal).then(es(this,eg)[eg],es(this,ev)[ev]),es(this,ec)[ec]=!0}function ek(){this.options.companionComm.resumeUploadFile(es(this,ep)[ep],es(this,eu)[eu],es(this,en)[en].signal).then(es(this,eg)[eg],es(this,ev)[ev])}function eR(){es(this,en)[en].abort(),this.options.companionComm.abortFileUpload(es(this,ep)[ep]).catch(e=>this.options.log(e))}function ex(e){if(null!=e&&e.aborted)throw et("The operation was aborted",{cause:e.reason})}let eT=new TextEncoder,e$={name:"HMAC",hash:"SHA-256"};async function eM(e){let{subtle:t}=globalThis.crypto;return t.digest(e$.hash,eT.encode(e))}async function eI(e){let{subtle:t}=globalThis.crypto;return t.importKey("raw","string"==typeof e?eT.encode(e):e,e$,!1,["sign"])}function ez(e){let t=new Uint8Array(e),i="";for(let e=0;e<t.length;e++)i+=t[e].toString(16).padStart(2,"0");return i}async function e_(e,t){let{subtle:i}=globalThis.crypto;return i.sign(e$,await eI(e),eT.encode(t))}async function eL(e){let{accountKey:t,accountSecret:i,sessionToken:s,bucketName:r,Key:o,Region:a,expires:l,uploadId:n,partNumber:u}=e,d=`s3.${a}.amazonaws.com`,h=`/${r}/${encodeURI(o).replace(/[;?:@&=+$,#!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`)}`,p="UNSIGNED-PAYLOAD",c=new Date().toISOString().replace(/[-:]|\.\d+/g,""),f=c.slice(0,8),g=`${f}/${a}/s3/aws4_request`,m=new URL(`https://${d}${h}`);m.searchParams.set("X-Amz-Algorithm","AWS4-HMAC-SHA256"),m.searchParams.set("X-Amz-Content-Sha256",p),m.searchParams.set("X-Amz-Credential",`${t}/${g}`),m.searchParams.set("X-Amz-Date",c),m.searchParams.set("X-Amz-Expires",l),m.searchParams.set("X-Amz-Security-Token",s),m.searchParams.set("X-Amz-SignedHeaders","host"),u&&m.searchParams.set("partNumber",u),n&&m.searchParams.set("uploadId",n),m.searchParams.set("x-id",u&&n?"UploadPart":"PutObject");let y=function(e){let{method:t="PUT",CanonicalUri:i="/",CanonicalQueryString:s="",SignedHeaders:r,HashedPayload:o}=e,a=Object.keys(r).map(e=>e.toLowerCase()).sort();return[t,i,s,...a.map(e=>`${e}:${r[e]}`),"",a.join(";"),o].join("\n")}({CanonicalUri:h,CanonicalQueryString:m.search.slice(1),SignedHeaders:{host:d},HashedPayload:p}),v=["AWS4-HMAC-SHA256",c,g,ez(await eM(y))].join("\n"),b=await e_(`AWS4${i}`,f),w=await e_(b,a),P=await e_(w,"s3"),S=await e_(P,"aws4_request"),O=ez(await e_(S,v));return m.searchParams.set("X-Amz-Signature",O),m}function eN(e,t){if(!({}).hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var eq=0;function eD(e){return"__private_"+eq+++"_"+e}var eH=eD("abortMultipartUpload"),eB=eD("cache"),eX=eD("createMultipartUpload"),eG=eD("fetchSignature"),eW=eD("getUploadParameters"),eY=eD("listParts"),eZ=eD("previousRetryDelay"),eV=eD("requests"),eK=eD("retryDelays"),eJ=eD("sendCompletionRequest"),eQ=eD("setS3MultipartState"),e0=eD("uploadPartBytes"),e1=eD("getFile"),e3=eD("shouldRetry"),e8=eD("nonMultipartUpload");class e4{constructor(e,t,i,s){Object.defineProperty(this,e8,{value:e5}),Object.defineProperty(this,e3,{value:e2}),Object.defineProperty(this,eH,{writable:!0,value:void 0}),Object.defineProperty(this,eB,{writable:!0,value:new WeakMap}),Object.defineProperty(this,eX,{writable:!0,value:void 0}),Object.defineProperty(this,eG,{writable:!0,value:void 0}),Object.defineProperty(this,eW,{writable:!0,value:void 0}),Object.defineProperty(this,eY,{writable:!0,value:void 0}),Object.defineProperty(this,eZ,{writable:!0,value:void 0}),Object.defineProperty(this,eV,{writable:!0,value:void 0}),Object.defineProperty(this,eK,{writable:!0,value:void 0}),Object.defineProperty(this,eJ,{writable:!0,value:void 0}),Object.defineProperty(this,eQ,{writable:!0,value:void 0}),Object.defineProperty(this,e0,{writable:!0,value:void 0}),Object.defineProperty(this,e1,{writable:!0,value:void 0}),eN(this,eV)[eV]=e,eN(this,eQ)[eQ]=i,eN(this,e1)[e1]=s,this.setOptions(t)}setOptions(e){let t=eN(this,eV)[eV];if("abortMultipartUpload"in e&&(eN(this,eH)[eH]=t.wrapPromiseFunction(e.abortMultipartUpload,{priority:1})),"createMultipartUpload"in e&&(eN(this,eX)[eX]=t.wrapPromiseFunction(e.createMultipartUpload,{priority:-1})),"signPart"in e&&(eN(this,eG)[eG]=t.wrapPromiseFunction(e.signPart)),"listParts"in e&&(eN(this,eY)[eY]=t.wrapPromiseFunction(e.listParts)),"completeMultipartUpload"in e&&(eN(this,eJ)[eJ]=t.wrapPromiseFunction(e.completeMultipartUpload,{priority:1})),"retryDelays"in e){var i;eN(this,eK)[eK]=null!=(i=e.retryDelays)?i:[]}"uploadPartBytes"in e&&(eN(this,e0)[e0]=t.wrapPromiseFunction(e.uploadPartBytes,{priority:1/0})),"getUploadParameters"in e&&(eN(this,eW)[eW]=t.wrapPromiseFunction(e.getUploadParameters))}async getUploadId(e,t){let i;for(;null!=(i=eN(this,eB)[eB].get(e.data));)try{return await i}catch{}let s=eN(this,eX)[eX](eN(this,e1)[e1](e),t),r=()=>{s.abort(t.reason),eN(this,eB)[eB].delete(e.data)};return t.addEventListener("abort",r,{once:!0}),eN(this,eB)[eB].set(e.data,s),s.then(async i=>{t.removeEventListener("abort",r),eN(this,eQ)[eQ](e,i),eN(this,eB)[eB].set(e.data,i)},()=>{t.removeEventListener("abort",r),eN(this,eB)[eB].delete(e.data)}),s}async abortFileUpload(e){let t,i=eN(this,eB)[eB].get(e.data);if(null!=i){eN(this,eB)[eB].delete(e.data),eN(this,eQ)[eQ](e,Object.create(null));try{t=await i}catch{return}await eN(this,eH)[eH](eN(this,e1)[e1](e),t)}}async uploadFile(e,t,i){if(ex(i),1===t.length&&!t[0].shouldUseMultipart)return eN(this,e8)[e8](e,t[0],i);let{uploadId:s,key:r}=await this.getUploadId(e,i);ex(i);try{let o=await Promise.all(t.map((t,s)=>this.uploadChunk(e,s+1,t,i)));return ex(i),await eN(this,eJ)[eJ](eN(this,e1)[e1](e),{key:r,uploadId:s,parts:o,signal:i},i).abortOn(i)}catch(t){throw(null==t?void 0:t.cause)!==el&&(null==t?void 0:t.name)!=="AbortError"&&this.abortFileUpload(e),t}}restoreUploadFile(e,t){eN(this,eB)[eB].set(e.data,t)}async resumeUploadFile(e,t,i){if(ex(i),1===t.length&&null!=t[0]&&!t[0].shouldUseMultipart)return eN(this,e8)[e8](e,t[0],i);let{uploadId:s,key:r}=await this.getUploadId(e,i);ex(i);let o=await eN(this,eY)[eY](eN(this,e1)[e1](e),{uploadId:s,key:r,signal:i},i).abortOn(i);ex(i);let a=await Promise.all(t.map((t,s)=>{let r=s+1,a=o.find(e=>{let{PartNumber:t}=e;return t===r});return null==a?this.uploadChunk(e,r,t,i):(null==t||null==t.setAsUploaded||t.setAsUploaded(),{PartNumber:r,ETag:a.ETag})}));return ex(i),eN(this,eJ)[eJ](eN(this,e1)[e1](e),{key:r,uploadId:s,parts:a,signal:i},i).abortOn(i)}async uploadChunk(e,t,i,s){ex(s);let{uploadId:r,key:o}=await this.getUploadId(e,s),a=eN(this,eK)[eK].values(),l=eN(this,eK)[eK].values(),n=()=>{let e=a.next();return null==e||e.done?null:e.value};for(;;){let a;ex(s);let u=i.getData(),{onProgress:d,onComplete:h}=i;try{a=await eN(this,eG)[eG](eN(this,e1)[e1](e),{uploadId:r,key:o,partNumber:t,body:u,signal:s}).abortOn(s)}catch(t){let e=n();if(null==e||s.aborted)throw t;await new Promise(t=>setTimeout(t,e));continue}ex(s);try{return{PartNumber:t,...await eN(this,e0)[e0]({signature:a,body:u,size:u.size,onProgress:d,onComplete:h,signal:s}).abortOn(s)}}catch(e){if(!await eN(this,e3)[e3](e,l))throw e}}}}async function e2(e,t){var i;let s=eN(this,eV)[eV],r=null==e||null==(i=e.source)?void 0:i.status;if(null==r)return!1;if(403===r&&"Request has expired"===e.message){if(!s.isPaused){if(1===s.limit||null==eN(this,eZ)[eZ]){let e=t.next();if(null==e||e.done)return!1;eN(this,eZ)[eZ]=e.value}s.rateLimit(0),await new Promise(e=>setTimeout(e,eN(this,eZ)[eZ]))}}else if(429===r){if(!s.isPaused){let e=t.next();if(null==e||e.done)return!1;s.rateLimit(e.value)}}else if(r>400&&r<500&&409!==r)return!1;else if("undefined"!=typeof navigator&&!1===navigator.onLine)s.isPaused||(s.pause(),window.addEventListener("online",()=>{s.resume()},{once:!0}));else{let e=t.next();if(null==e||e.done)return!1;await new Promise(t=>setTimeout(t,e.value))}return!0}async function e5(e,t,i){var s;let r,{method:o="POST",url:a,fields:l,headers:n}=await eN(this,eW)[eW](eN(this,e1)[e1](e),{signal:i}).abortOn(i),u=t.getData();if("POST"===o.toUpperCase()){let e=new FormData;Object.entries(l).forEach(t=>{let[i,s]=t;return e.set(i,s)}),e.set("file",u),r=e}else r=u;let{onProgress:d,onComplete:h}=t,p=await eN(this,e0)[e0]({signature:{url:a,headers:n,method:o},body:r,size:u.size,onProgress:d,onComplete:h,signal:i}).abortOn(i),c=null==l?void 0:l.key;return eN(this,eQ)[eQ](e,{key:c}),{...p,location:null!=(s=p.location)?s:function(e){let t=new URL(e);return t.search="",t.hash="",t.href}(a),bucket:null==l?void 0:l.bucket,key:c}}function e9(e,t){if(!({}).hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var e6=0;function e7(e){return"__private_"+e6+++"_"+e}function te(e){if(null!=e&&e.error){let t=Error(e.message);throw Object.assign(t,e.error),t}return e}function tt(e){let t=e.Expiration;if(t){let e=Math.floor((new Date(t)-Date.now())/1e3);if(e>9)return e}}function ti(e){let{meta:t,allowedMetaFields:i,querify:s=!1}=e,r=null!=i?i:Object.keys(t);return t?Object.fromEntries(r.filter(e=>null!=t[e]).map(e=>[s?`metadata[${e}]`:e,String(t[e])])):{}}let ts={allowedMetaFields:!0,limit:6,getTemporarySecurityCredentials:!1,shouldUseMultipart:e=>(e.size||0)>0x6400000,retryDelays:[0,1e3,3e3,5e3]};var tr=e7("companionCommunicationQueue"),to=e7("client"),ta=e7("setClient"),tl=e7("assertHost"),tn=e7("cachedTemporaryCredentials"),tu=e7("getTemporarySecurityCredentials"),td=e7("setS3MultipartState"),th=e7("getFile"),tp=e7("uploadLocalFile"),tc=e7("getCompanionClientArgs"),tf=e7("upload"),tg=e7("setCompanionHeaders"),tm=e7("setResumableUploadsCapability"),ty=e7("resetResumableCapability");class tv extends r{constructor(e,t){var i;super(e,{...ts,uploadPartBytes:tv.uploadPartBytes,createMultipartUpload:null,listParts:null,abortMultipartUpload:null,completeMultipartUpload:null,signPart:null,getUploadParameters:null,...t}),Object.defineProperty(this,tc,{value:tO}),Object.defineProperty(this,tp,{value:tS}),Object.defineProperty(this,tu,{value:tP}),Object.defineProperty(this,tl,{value:tw}),Object.defineProperty(this,ta,{value:tb}),Object.defineProperty(this,tr,{writable:!0,value:void 0}),Object.defineProperty(this,to,{writable:!0,value:void 0}),Object.defineProperty(this,tn,{writable:!0,value:void 0}),Object.defineProperty(this,td,{writable:!0,value:(e,t)=>{let{key:i,uploadId:s}=t,r=this.uppy.getFile(e.id);null!=r&&this.uppy.setFileState(e.id,{s3Multipart:{...r.s3Multipart,key:i,uploadId:s}})}}),Object.defineProperty(this,th,{writable:!0,value:e=>this.uppy.getFile(e.id)||e}),Object.defineProperty(this,tf,{writable:!0,value:async e=>{if(0===e.length)return;let t=this.uppy.getFilesByIds(e).filter(e=>!("error"in e&&e.error)),i=t.filter(e=>{var t;return!(null!=(t=e.progress)&&t.uploadStarted)||!e.isRestored});this.uppy.emit("upload-start",i);let s=t.map(e=>{if(e.isRemote){let t=()=>this.requests;e9(this,tm)[tm](!1);let i=new AbortController,s=t=>{t.id===e.id&&i.abort()};this.uppy.on("file-removed",s);let r=this.uppy.getRequestClientForFile(e).uploadRemoteFile(e,e9(this,tc)[tc](e),{signal:i.signal,getQueue:t});return this.requests.wrapSyncFunction(()=>{this.uppy.off("file-removed",s)},{priority:-1})(),r}return e9(this,tp)[tp](e)}),r=await Promise.allSettled(s);return e9(this,tm)[tm](!0),r}}),Object.defineProperty(this,tg,{writable:!0,value:()=>{var e;null==(e=e9(this,to)[to])||e.setCompanionHeaders(this.opts.headers)}}),Object.defineProperty(this,tm,{writable:!0,value:e=>{let{capabilities:t}=this.uppy.getState();this.uppy.setState({capabilities:{...t,resumableUploads:e}})}}),Object.defineProperty(this,ty,{writable:!0,value:()=>{e9(this,tm)[tm](!0)}}),this.type="uploader",this.id=this.opts.id||"AwsS3Multipart",e9(this,ta)[ta](t);let s={createMultipartUpload:this.createMultipartUpload,listParts:this.listParts,abortMultipartUpload:this.abortMultipartUpload,completeMultipartUpload:this.completeMultipartUpload,signPart:null!=t&&t.getTemporarySecurityCredentials?this.createSignedURL:this.signPart,getUploadParameters:null!=t&&t.getTemporarySecurityCredentials?this.createSignedURL:this.getUploadParameters};for(let e of Object.keys(s))null==this.opts[e]&&(this.opts[e]=s[e].bind(this));this.requests=null!=(i=this.opts.rateLimitedQueue)?i:new W(this.opts.limit),e9(this,tr)[tr]=new e4(this.requests,this.opts,e9(this,td)[td],e9(this,th)[th]),this.uploaders=Object.create(null),this.uploaderEvents=Object.create(null)}[Symbol.for("uppy test: getClient")](){return e9(this,to)[to]}setOptions(e){e9(this,tr)[tr].setOptions(e),super.setOptions(e),e9(this,ta)[ta](e)}resetUploaderReferences(e,t){this.uploaders[e]&&(this.uploaders[e].abort({really:(null==t?void 0:t.abort)||!1}),this.uploaders[e]=null),this.uploaderEvents[e]&&(this.uploaderEvents[e].remove(),this.uploaderEvents[e]=null)}createMultipartUpload(e,t){e9(this,tl)[tl]("createMultipartUpload"),ex(t);let i=ei(this.opts.allowedMetaFields,e.meta),s=ti({meta:e.meta,allowedMetaFields:i});return e9(this,to)[to].post("s3/multipart",{filename:e.name,type:e.type,metadata:s},{signal:t}).then(te)}listParts(e,t,i){let{key:s,uploadId:r,signal:o}=t;null!=o||(o=i),e9(this,tl)[tl]("listParts"),ex(o);let a=encodeURIComponent(s);return e9(this,to)[to].get(`s3/multipart/${encodeURIComponent(r)}?key=${a}`,{signal:o}).then(te)}completeMultipartUpload(e,t,i){let{key:s,uploadId:r,parts:o,signal:a}=t;null!=a||(a=i),e9(this,tl)[tl]("completeMultipartUpload"),ex(a);let l=encodeURIComponent(s),n=encodeURIComponent(r);return e9(this,to)[to].post(`s3/multipart/${n}/complete?key=${l}`,{parts:o.map(e=>{let{ETag:t,PartNumber:i}=e;return{ETag:t,PartNumber:i}})},{signal:a}).then(te)}async createSignedURL(e,t){let i=await e9(this,tu)[tu](t),s=tt(i.credentials)||604800,{uploadId:r,key:o,partNumber:a}=t;return{method:"PUT",expires:s,fields:{},url:`${await eL({accountKey:i.credentials.AccessKeyId,accountSecret:i.credentials.SecretAccessKey,sessionToken:i.credentials.SessionToken,expires:s,bucketName:i.bucket,Region:i.region,Key:null!=o?o:`${crypto.randomUUID()}-${e.name}`,uploadId:r,partNumber:a})}`,headers:{"Content-Type":e.type}}}signPart(e,t){let{uploadId:i,key:s,partNumber:r,signal:o}=t;if(e9(this,tl)[tl]("signPart"),ex(o),null==i||null==s||null==r)throw Error("Cannot sign without a key, an uploadId, and a partNumber");let a=encodeURIComponent(s);return e9(this,to)[to].get(`s3/multipart/${encodeURIComponent(i)}/${r}?key=${a}`,{signal:o}).then(te)}abortMultipartUpload(e,t){let{key:i,uploadId:s,signal:r}=t;e9(this,tl)[tl]("abortMultipartUpload");let o=encodeURIComponent(i),a=encodeURIComponent(s);return e9(this,to)[to].delete(`s3/multipart/${a}?key=${o}`,void 0,{signal:r}).then(te)}getUploadParameters(e,t){e9(this,tl)[tl]("getUploadParameters");let{meta:i}=e,{type:s,name:r}=i,o=new URLSearchParams({filename:r,type:s,...ti({meta:i,allowedMetaFields:ei(this.opts.allowedMetaFields,e.meta),querify:!0})});return e9(this,to)[to].get(`s3/params?${o}`,t)}static async uploadPartBytes(e){let{signature:{url:t,expires:i,headers:s,method:r="PUT"},body:o,size:a=o.size,onProgress:l,onComplete:n,signal:u}=e;if(ex(u),null==t)throw Error("Cannot upload to an undefined URL");return new Promise((e,d)=>{let h=new XMLHttpRequest;function p(){h.abort()}function c(){null==u||u.removeEventListener("abort",p)}h.open(r,t,!0),s&&Object.keys(s).forEach(e=>{h.setRequestHeader(e,s[e])}),h.responseType="text","number"==typeof i&&(h.timeout=1e3*i),null==u||u.addEventListener("abort",p),h.upload.addEventListener("progress",e=>{l(e)}),h.addEventListener("abort",()=>{c(),d(et())}),h.addEventListener("timeout",()=>{c();let e=Error("Request has expired");e.source={status:403},d(e)}),h.addEventListener("load",()=>{if(c(),403===h.status&&h.responseText.includes("<Message>Request has expired</Message>")){let e=Error("Request has expired");e.source=h,d(e);return}if(h.status<200||h.status>=300){let e=Error("Non 2xx");e.source=h,d(e);return}null==l||l({loaded:a,lengthComputable:!0});let t=h.getAllResponseHeaders().trim().split(/[\r\n]+/),i={__proto__:null};for(let e of t){let t=e.split(": "),s=t.shift(),r=t.join(": ");i[s]=r}let{etag:s,location:o}=i;if("POST"===r.toUpperCase()&&null==o&&console.error("@uppy/aws-s3: Could not read the Location header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3/#setting-up-your-s3-bucket"),null==s)return void console.error("@uppy/aws-s3: Could not read the ETag header. This likely means CORS is not configured correctly on the S3 Bucket. See https://uppy.io/docs/aws-s3/#setting-up-your-s3-bucket");null==n||n(s),e({...i,ETag:s})}),h.addEventListener("error",e=>{c();let t=Error("Unknown error");t.source=e.target,d(t)}),h.send(o)})}install(){e9(this,tm)[tm](!0),this.uppy.addPreProcessor(e9(this,tg)[tg]),this.uppy.addUploader(e9(this,tf)[tf]),this.uppy.on("cancel-all",e9(this,ty)[ty])}uninstall(){this.uppy.removePreProcessor(e9(this,tg)[tg]),this.uppy.removeUploader(e9(this,tf)[tf]),this.uppy.off("cancel-all",e9(this,ty)[ty])}}function tb(e){null!=e&&("endpoint"in e||"companionUrl"in e||"headers"in e||"companionHeaders"in e||"cookiesRule"in e||"companionCookiesRule"in e)&&("companionUrl"in e&&!("endpoint"in e)&&this.uppy.log("`companionUrl` option has been removed in @uppy/aws-s3, use `endpoint` instead.","warning"),"companionHeaders"in e&&!("headers"in e)&&this.uppy.log("`companionHeaders` option has been removed in @uppy/aws-s3, use `headers` instead.","warning"),"companionCookiesRule"in e&&!("cookiesRule"in e)&&this.uppy.log("`companionCookiesRule` option has been removed in @uppy/aws-s3, use `cookiesRule` instead.","warning"),"endpoint"in e?e9(this,to)[to]=new w(this.uppy,{pluginId:this.id,provider:"AWS",companionUrl:this.opts.endpoint,companionHeaders:this.opts.headers,companionCookiesRule:this.opts.cookiesRule}):("headers"in e&&e9(this,tg)[tg](),"cookiesRule"in e&&(e9(this,to)[to].opts.companionCookiesRule=e.cookiesRule)))}function tw(e){if(!e9(this,to)[to])throw Error(`Expected a \`endpoint\` option containing a URL, or if you are not using Companion, a custom \`${e}\` implementation.`)}async function tP(e){if(ex(null==e?void 0:e.signal),null==e9(this,tn)[tn]){let{getTemporarySecurityCredentials:t}=this.opts;!0===t?(e9(this,tl)[tl]("getTemporarySecurityCredentials"),e9(this,tn)[tn]=e9(this,to)[to].get("s3/sts",e).then(te)):e9(this,tn)[tn]=t(e),e9(this,tn)[tn]=await e9(this,tn)[tn],setTimeout(()=>{e9(this,tn)[tn]=null},500*(tt(e9(this,tn)[tn].credentials)||0))}return e9(this,tn)[tn]}function tS(e){var t=this;return new Promise((i,s)=>{let r=(t,i)=>{var s;let r=this.uppy.getFile(e.id);this.uppy.emit("upload-progress",r,{uploadStarted:null!=(s=r.progress.uploadStarted)?s:0,bytesUploaded:t,bytesTotal:i})},o=t=>{this.uppy.log(t),this.uppy.emit("upload-error",e,t),this.resetUploaderReferences(e.id),s(t)},a=t=>{let s={body:{...t},status:200,uploadURL:t.location};this.resetUploaderReferences(e.id),this.uppy.emit("upload-success",e9(this,th)[th](e),s),t.location&&this.uppy.log(`Download ${e.name} from ${t.location}`),i()},l=new eE(e.data,{companionComm:e9(this,tr)[tr],log:function(){return t.uppy.log(...arguments)},getChunkSize:this.opts.getChunkSize?this.opts.getChunkSize.bind(this):void 0,onProgress:r,onError:o,onSuccess:a,onPartComplete:t=>{this.uppy.emit("s3-multipart:part-uploaded",e9(this,th)[th](e),t)},file:e,shouldUseMultipart:this.opts.shouldUseMultipart,...e.s3Multipart});this.uploaders[e.id]=l;let n=new C(this.uppy);this.uploaderEvents[e.id]=n,n.onFileRemove(e.id,t=>{l.abort(),this.resetUploaderReferences(e.id,{abort:!0}),i(`upload ${t} was removed`)}),n.onCancelAll(e.id,()=>{l.abort(),this.resetUploaderReferences(e.id,{abort:!0}),i(`upload ${e.id} was canceled`)}),n.onFilePause(e.id,e=>{e?l.pause():l.start()}),n.onPauseAll(e.id,()=>{l.pause()}),n.onResumeAll(e.id,()=>{l.start()}),l.start()})}function tO(e){var t;return{...null==(t=e.remote)?void 0:t.body,protocol:"s3-multipart",size:e.data.size,metadata:e.meta}}tv.VERSION="4.2.3"},51606:function(e,t,i){i.d(t,{Z:()=>eP});var s=i(59905),r=i(44800),o=i(23493);function a(e,t){if(!({}).hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var l=0;function n(e){return"__private_"+l+++"_"+e}var u=n("callbacks"),d=n("publish");class h{constructor(){Object.defineProperty(this,d,{value:p}),this.state={},Object.defineProperty(this,u,{writable:!0,value:new Set})}getState(){return this.state}setState(e){let t={...this.state},i={...this.state,...e};this.state=i,a(this,d)[d](t,i,e)}subscribe(e){return a(this,u)[u].add(e),()=>{a(this,u)[u].delete(e)}}}function p(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];a(this,u)[u].forEach(e=>{e(...t)})}function c(e){let t=e.lastIndexOf(".");return -1===t||t===e.length-1?{name:e,extension:void 0}:{name:e.slice(0,t),extension:e.slice(t+1)}}h.VERSION="4.2.0";let f={__proto__:null,md:"text/markdown",markdown:"text/markdown",mp4:"video/mp4",mp3:"audio/mp3",svg:"image/svg+xml",jpg:"image/jpeg",png:"image/png",webp:"image/webp",gif:"image/gif",heic:"image/heic",heif:"image/heif",yaml:"text/yaml",yml:"text/yaml",csv:"text/csv",tsv:"text/tab-separated-values",tab:"text/tab-separated-values",avi:"video/x-msvideo",mks:"video/x-matroska",mkv:"video/x-matroska",mov:"video/quicktime",dicom:"application/dicom",doc:"application/msword",msg:"application/vnd.ms-outlook",docm:"application/vnd.ms-word.document.macroenabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",xla:"application/vnd.ms-excel",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlc:"application/vnd.ms-excel",xlf:"application/x-xliff+xml",xlm:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroenabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlw:"application/vnd.ms-excel",txt:"text/plain",text:"text/plain",conf:"text/plain",log:"text/plain",pdf:"application/pdf",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/x-rar-compressed",tar:"application/x-tar",gz:"application/gzip",dmg:"application/x-apple-diskimage"};function g(e){var t;if(e.type)return e.type;let i=e.name?null==(t=c(e.name).extension)?void 0:t.toLowerCase():null;return i&&i in f?f[i]:"application/octet-stream"}function m(e){let t="";return e.replace(/[^A-Z0-9]/gi,e=>(t+=`-${e.charCodeAt(0).toString(32)}`,"/"))+t}function y(e){return e<10?`0${e}`:e.toString()}function v(){let e=new Date,t=y(e.getHours()),i=y(e.getMinutes()),s=y(e.getSeconds());return`${t}:${i}:${s}`}let b={debug:()=>{},warn:()=>{},error:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.error(`[Uppy] [${v()}]`,...t)}},w={debug:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.debug(`[Uppy] [${v()}]`,...t)},warn:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.warn(`[Uppy] [${v()}]`,...t)},error:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return console.error(`[Uppy] [${v()}]`,...t)}};var P=i(54753),S=i(24193);let O={maxFileSize:null,minFileSize:null,maxTotalFileSize:null,maxNumberOfFiles:null,minNumberOfFiles:null,allowedFileTypes:null,requiredMetaFields:[]};class F extends Error{constructor(e,t){var i;super(e),this.isRestriction=!0,this.isUserFacing=null==(i=null==t?void 0:t.isUserFacing)||i,null!=t&&t.file&&(this.file=t.file)}}class U{constructor(e,t){this.getI18n=t,this.getOpts=()=>{var t;let i=e();if((null==(t=i.restrictions)?void 0:t.allowedFileTypes)!=null&&!Array.isArray(i.restrictions.allowedFileTypes))throw TypeError("`restrictions.allowedFileTypes` must be an array");return i}}validateAggregateRestrictions(e,t){let{maxTotalFileSize:i,maxNumberOfFiles:s}=this.getOpts().restrictions;if(s&&e.filter(e=>!e.isGhost).length+t.length>s)throw new F(`${this.getI18n()("youCanOnlyUploadX",{smart_count:s})}`);if(i){let s=[...e,...t].reduce((e,t)=>{var i;return e+(null!=(i=t.size)?i:0)},0);if(s>i)throw new F(this.getI18n()("aggregateExceedsSize",{sizeAllowed:P(i),size:P(s)}))}}validateSingleFile(e){let{maxFileSize:t,minFileSize:i,allowedFileTypes:s}=this.getOpts().restrictions;if(s&&!s.some(t=>t.includes("/")?!!e.type&&S(e.type.replace(/;.*?$/,""),t):"."===t[0]&&!!e.extension&&e.extension.toLowerCase()===t.slice(1).toLowerCase())){let t=s.join(", ");throw new F(this.getI18n()("youCanOnlyUploadFileTypes",{types:t}),{file:e})}if(t&&null!=e.size&&e.size>t){var r;throw new F(this.getI18n()("exceedsSize",{size:P(t),file:null!=(r=e.name)?r:this.getI18n()("unnamed")}),{file:e})}if(i&&null!=e.size&&e.size<i)throw new F(this.getI18n()("inferiorSize",{size:P(i)}),{file:e})}validate(e,t){t.forEach(e=>{this.validateSingleFile(e)}),this.validateAggregateRestrictions(e,t)}validateMinNumberOfFiles(e){let{minNumberOfFiles:t}=this.getOpts().restrictions;if(t&&Object.keys(e).length<t)throw new F(this.getI18n()("youHaveToAtLeastSelectX",{smart_count:t}))}getMissingRequiredMetaFields(e){var t;let i=new F(this.getI18n()("missingRequiredMetaFieldOnFile",{fileName:null!=(t=e.name)?t:this.getI18n()("unnamed")})),{requiredMetaFields:s}=this.getOpts().restrictions,r=[];for(let t of s)Object.hasOwn(e.meta,t)&&""!==e.meta[t]||r.push(t);return{missingFields:r,error:i}}}let j={strings:{addBulkFilesFailed:{0:"Failed to add %{smart_count} file due to an internal error",1:"Failed to add %{smart_count} files due to internal errors"},youCanOnlyUploadX:{0:"You can only upload %{smart_count} file",1:"You can only upload %{smart_count} files"},youHaveToAtLeastSelectX:{0:"You have to select at least %{smart_count} file",1:"You have to select at least %{smart_count} files"},aggregateExceedsSize:"You selected %{size} of files, but maximum allowed size is %{sizeAllowed}",exceedsSize:"%{file} exceeds maximum allowed size of %{size}",missingRequiredMetaField:"Missing required meta fields",missingRequiredMetaFieldOnFile:"Missing required meta fields in %{fileName}",inferiorSize:"This file is smaller than the allowed size of %{size}",youCanOnlyUploadFileTypes:"You can only upload: %{types}",noMoreFilesAllowed:"Cannot add more files",noDuplicates:"Cannot add the duplicate file '%{fileName}', it already exists",companionError:"Connection with Companion failed",authAborted:"Authentication aborted",companionUnauthorizeHint:"To unauthorize to your %{provider} account, please go to %{url}",failedToUpload:"Failed to upload %{file}",noInternetConnection:"No Internet connection",connectedToInternet:"Connected to the Internet",noFilesFound:"You have no files or folders here",noSearchResults:"Unfortunately, there are no results for this search",selectX:{0:"Select %{smart_count}",1:"Select %{smart_count}"},allFilesFromFolderNamed:"All files from folder %{name}",openFolderNamed:"Open folder %{name}",cancel:"Cancel",logOut:"Log out",logIn:"Log in",pickFiles:"Pick files",pickPhotos:"Pick photos",filter:"Filter",resetFilter:"Reset filter",loading:"Loading...",loadedXFiles:"Loaded %{numFiles} files",authenticateWithTitle:"Please authenticate with %{pluginName} to select files",authenticateWith:"Connect to %{pluginName}",signInWithGoogle:"Sign in with Google",searchImages:"Search for images",enterTextToSearch:"Enter text to search for images",search:"Search",resetSearch:"Reset search",emptyFolderAdded:"No files were added from empty folder",addedNumFiles:"Added %{numFiles} file(s)",folderAlreadyAdded:'The folder "%{folder}" was already added',folderAdded:{0:"Added %{smart_count} file from %{folder}",1:"Added %{smart_count} files from %{folder}"},additionalRestrictionsFailed:"%{count} additional restrictions were not fulfilled",unnamed:"Unnamed",pleaseWait:"Please wait"}};function E(e,t){if(!({}).hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}var C=0;function A(e){return"__private_"+C+++"_"+e}let k={totalProgress:0,allowNewUpload:!0,error:null,recoveredState:null};var R=A("plugins"),x=A("restricter"),T=A("storeUnsubscribe"),$=A("emitter"),M=A("preProcessors"),I=A("uploaders"),z=A("postProcessors"),_=A("informAndEmit"),L=A("checkRequiredMetaFieldsOnFile"),N=A("checkRequiredMetaFields"),q=A("assertNewUploadAllowed"),D=A("transformFile"),H=A("startIfAutoProceed"),B=A("checkAndUpdateFileState"),X=A("getFilesToRetry"),G=A("doRetryAll"),W=A("handleUploadProgress"),Y=A("updateTotalProgress"),Z=A("updateTotalProgressThrottled"),V=A("calculateTotalProgress"),K=A("addListeners"),J=A("updateOnlineStatus"),Q=A("requestClientById"),ee=A("createUpload"),et=A("getUpload"),ei=A("removeUpload"),es=A("runUpload");class er{constructor(e){Object.defineProperty(this,es,{value:ew}),Object.defineProperty(this,ei,{value:eb}),Object.defineProperty(this,et,{value:ev}),Object.defineProperty(this,ee,{value:ey}),Object.defineProperty(this,K,{value:em}),Object.defineProperty(this,V,{value:eg}),Object.defineProperty(this,Y,{value:ef}),Object.defineProperty(this,G,{value:ec}),Object.defineProperty(this,X,{value:ep}),Object.defineProperty(this,B,{value:eh}),Object.defineProperty(this,H,{value:ed}),Object.defineProperty(this,D,{value:eu}),Object.defineProperty(this,q,{value:en}),Object.defineProperty(this,N,{value:el}),Object.defineProperty(this,L,{value:ea}),Object.defineProperty(this,_,{value:eo}),Object.defineProperty(this,R,{writable:!0,value:Object.create(null)}),Object.defineProperty(this,x,{writable:!0,value:void 0}),Object.defineProperty(this,T,{writable:!0,value:void 0}),Object.defineProperty(this,$,{writable:!0,value:r()}),Object.defineProperty(this,M,{writable:!0,value:new Set}),Object.defineProperty(this,I,{writable:!0,value:new Set}),Object.defineProperty(this,z,{writable:!0,value:new Set}),this.scheduledAutoProceed=null,this.wasOffline=!1,Object.defineProperty(this,W,{writable:!0,value:(e,t)=>{let i=e?this.getFile(e.id):void 0;if(null==e||!i)return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);if(100===i.progress.percentage)return void this.log(`Not setting progress for a file that has been already uploaded: ${e.id}`);let s={bytesTotal:t.bytesTotal,percentage:null!=t.bytesTotal&&Number.isFinite(t.bytesTotal)&&t.bytesTotal>0?Math.round(t.bytesUploaded/t.bytesTotal*100):void 0};null!=i.progress.uploadStarted?this.setFileState(e.id,{progress:{...i.progress,...s,bytesUploaded:t.bytesUploaded}}):this.setFileState(e.id,{progress:{...i.progress,...s}}),E(this,Z)[Z]()}}),Object.defineProperty(this,Z,{writable:!0,value:o(()=>E(this,Y)[Y](),500,{leading:!0,trailing:!0})}),Object.defineProperty(this,J,{writable:!0,value:this.updateOnlineStatus.bind(this)}),Object.defineProperty(this,Q,{writable:!0,value:new Map}),this.defaultLocale=j;let t={id:"uppy",autoProceed:!1,allowMultipleUploadBatches:!0,debug:!1,restrictions:O,meta:{},onBeforeFileAdded:(e,t)=>!Object.hasOwn(t,e.id),onBeforeUpload:e=>e,store:new h,logger:b,infoTimeout:5e3},i={...t,...e};this.opts={...i,restrictions:{...t.restrictions,...e&&e.restrictions}},e&&e.logger&&e.debug?this.log("You are using a custom `logger`, but also set `debug: true`, which uses built-in logger to output logs to console. Ignoring `debug: true` and using your custom `logger`.","warning"):e&&e.debug&&(this.opts.logger=w),this.log(`Using Core v${er.VERSION}`),this.i18nInit(),this.store=this.opts.store,this.setState({...k,plugins:{},files:{},currentUploads:{},capabilities:{uploadProgress:function(e){if(null==e&&"undefined"!=typeof navigator&&(e=navigator.userAgent),!e)return!0;let t=/Edge\/(\d+\.\d+)/.exec(e);if(!t)return!0;let i=t[1].split(".",2),s=parseInt(i[0],10),r=parseInt(i[1],10);return!!(s<15)||15===s&&!!(r<15063)||!!(s>18)||18===s&&!!(r>=18218)}(),individualCancellation:!0,resumableUploads:!1},meta:{...this.opts.meta},info:[]}),E(this,x)[x]=new U(()=>this.opts,()=>this.i18n),E(this,T)[T]=this.store.subscribe((e,t,i)=>{this.emit("state-update",e,t,i),this.updateAll(t)}),this.opts.debug&&"undefined"!=typeof window&&(window[this.opts.id]=this),E(this,K)[K]()}emit(e){for(var t=arguments.length,i=Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];E(this,$)[$].emit(e,...i)}on(e,t){return E(this,$)[$].on(e,t),this}once(e,t){return E(this,$)[$].once(e,t),this}off(e,t){return E(this,$)[$].off(e,t),this}updateAll(e){this.iteratePlugins(t=>{t.update(e)})}setState(e){this.store.setState(e)}getState(){return this.store.getState()}patchFilesState(e){let t=this.getState().files;this.setState({files:{...t,...Object.fromEntries(Object.entries(e).map(e=>{let[i,s]=e;return[i,{...t[i],...s}]}))}})}setFileState(e,t){if(!this.getState().files[e])throw Error(`Cant set state for ${e} (the file could have been removed)`);this.patchFilesState({[e]:t})}i18nInit(){let e=e=>this.log(`Missing i18n string: ${e}`,"error"),t=new s.Z([this.defaultLocale,this.opts.locale],{onMissingKey:e});this.i18n=t.translate.bind(t),this.i18nArray=t.translateArray.bind(t),this.locale=t.locale}setOptions(e){this.opts={...this.opts,...e,restrictions:{...this.opts.restrictions,...null==e?void 0:e.restrictions}},e.meta&&this.setMeta(e.meta),this.i18nInit(),e.locale&&this.iteratePlugins(t=>{t.setOptions(e)}),this.setState(void 0)}resetProgress(){let e={percentage:0,bytesUploaded:!1,uploadComplete:!1,uploadStarted:null},t={...this.getState().files},i=Object.create(null);Object.keys(t).forEach(s=>{i[s]={...t[s],progress:{...t[s].progress,...e},tus:void 0,transloadit:void 0}}),this.setState({files:i,...k})}clear(){let{capabilities:e,currentUploads:t}=this.getState();if(Object.keys(t).length>0&&!e.individualCancellation)throw Error("The installed uploader plugin does not allow removing files during an upload.");this.setState({...k,files:{}})}addPreProcessor(e){E(this,M)[M].add(e)}removePreProcessor(e){return E(this,M)[M].delete(e)}addPostProcessor(e){E(this,z)[z].add(e)}removePostProcessor(e){return E(this,z)[z].delete(e)}addUploader(e){E(this,I)[I].add(e)}removeUploader(e){return E(this,I)[I].delete(e)}setMeta(e){let t={...this.getState().meta,...e},i={...this.getState().files};Object.keys(i).forEach(t=>{i[t]={...i[t],meta:{...i[t].meta,...e}}}),this.log("Adding metadata:"),this.log(e),this.setState({meta:t,files:i})}setFileMeta(e,t){let i={...this.getState().files};if(!i[e])return void this.log(`Was trying to set metadata for a file that has been removed: ${e}`);let s={...i[e].meta,...t};i[e]={...i[e],meta:s},this.setState({files:i})}getFile(e){return this.getState().files[e]}getFiles(){let{files:e}=this.getState();return Object.values(e)}getFilesByIds(e){return e.map(e=>this.getFile(e))}getObjectOfFilesPerState(){let{files:e,totalProgress:t,error:i}=this.getState(),s=Object.values(e),r=[],o=[],a=[],l=[],n=[],u=[],d=[],h=[],p=[];for(let e of s){let{progress:t}=e;!t.uploadComplete&&t.uploadStarted&&(r.push(e),e.isPaused||h.push(e)),t.uploadStarted||o.push(e),(t.uploadStarted||t.preprocess||t.postprocess)&&a.push(e),t.uploadStarted&&l.push(e),e.isPaused&&n.push(e),t.uploadComplete&&u.push(e),e.error&&d.push(e),(t.preprocess||t.postprocess)&&p.push(e)}return{newFiles:o,startedFiles:a,uploadStartedFiles:l,pausedFiles:n,completeFiles:u,erroredFiles:d,inProgressFiles:r,inProgressNotPausedFiles:h,processingFiles:p,isUploadStarted:l.length>0,isAllComplete:100===t&&u.length===s.length&&0===p.length,isAllErrored:!!i&&d.length===s.length,isAllPaused:0!==r.length&&n.length===r.length,isUploadInProgress:r.length>0,isSomeGhost:s.some(e=>e.isGhost)}}validateRestrictions(e,t){void 0===t&&(t=this.getFiles());try{E(this,x)[x].validate(t,[e])}catch(e){return e}return null}validateSingleFile(e){try{E(this,x)[x].validateSingleFile(e)}catch(e){return e.message}return null}validateAggregateRestrictions(e){let t=this.getFiles();try{E(this,x)[x].validateAggregateRestrictions(t,e)}catch(e){return e.message}return null}checkIfFileAlreadyExists(e){let{files:t}=this.getState();return!!t[e]&&!t[e].isGhost}addFile(e){E(this,q)[q](e);let{nextFilesState:t,validFilesToAdd:i,errors:s}=E(this,B)[B]([e]),r=s.filter(e=>e.isRestriction);if(E(this,_)[_](r),s.length>0)throw s[0];this.setState({files:t});let[o]=i;return this.emit("file-added",o),this.emit("files-added",i),this.log(`Added file: ${o.name}, ${o.id}, mime type: ${o.type}`),E(this,H)[H](),o.id}addFiles(e){E(this,q)[q]();let{nextFilesState:t,validFilesToAdd:i,errors:s}=E(this,B)[B](e),r=s.filter(e=>e.isRestriction);E(this,_)[_](r);let o=s.filter(e=>!e.isRestriction);if(o.length>0){let e="Multiple errors occurred while adding files:\n";if(o.forEach(t=>{e+=`
 * ${t.message}`}),this.info({message:this.i18n("addBulkFilesFailed",{smart_count:o.length}),details:e},"error",this.opts.infoTimeout),"function"==typeof AggregateError)throw AggregateError(o,e);{let t=Error(e);throw t.errors=o,t}}this.setState({files:t}),i.forEach(e=>{this.emit("file-added",e)}),this.emit("files-added",i),i.length>5?this.log(`Added batch of ${i.length} files`):Object.values(i).forEach(e=>{this.log(`Added file: ${e.name}
 id: ${e.id}
 type: ${e.type}`)}),i.length>0&&E(this,H)[H]()}removeFiles(e){let{files:t,currentUploads:i}=this.getState(),s={...t},r={...i},o=Object.create(null);function a(e){return void 0===o[e]}e.forEach(e=>{t[e]&&(o[e]=t[e],delete s[e])}),Object.keys(r).forEach(e=>{let t=i[e].fileIDs.filter(a);if(0===t.length)return void delete r[e];let{capabilities:s}=this.getState();if(t.length!==i[e].fileIDs.length&&!s.individualCancellation)throw Error("The installed uploader plugin does not allow removing files during an upload.");r[e]={...i[e],fileIDs:t}});let l={currentUploads:r,files:s};0===Object.keys(s).length&&(l.allowNewUpload=!0,l.error=null,l.recoveredState=null),this.setState(l),E(this,Z)[Z]();let n=Object.keys(o);n.forEach(e=>{this.emit("file-removed",o[e])}),n.length>5?this.log(`Removed ${n.length} files`):this.log(`Removed files: ${n.join(", ")}`)}removeFile(e){this.removeFiles([e])}pauseResume(e){if(!this.getState().capabilities.resumableUploads||this.getFile(e).progress.uploadComplete)return;let t=this.getFile(e),i=!t.isPaused;return this.setFileState(e,{isPaused:i}),this.emit("upload-pause",t,i),i}pauseAll(){let e={...this.getState().files};Object.keys(e).filter(t=>!e[t].progress.uploadComplete&&e[t].progress.uploadStarted).forEach(t=>{let i={...e[t],isPaused:!0};e[t]=i}),this.setState({files:e}),this.emit("pause-all")}resumeAll(){let e={...this.getState().files};Object.keys(e).filter(t=>!e[t].progress.uploadComplete&&e[t].progress.uploadStarted).forEach(t=>{let i={...e[t],isPaused:!1,error:null};e[t]=i}),this.setState({files:e}),this.emit("resume-all")}async retryAll(){let e=await E(this,G)[G]();return this.emit("complete",e),e}cancelAll(){this.emit("cancel-all");let{files:e}=this.getState(),t=Object.keys(e);t.length&&this.removeFiles(t),this.setState(k)}retryUpload(e){this.setFileState(e,{error:null,isPaused:!1}),this.emit("upload-retry",this.getFile(e));let t=E(this,ee)[ee]([e],{forceAllowNewUpload:!0});return E(this,es)[es](t)}logout(){this.iteratePlugins(e=>{var t;null==(t=e.provider)||null==t.logout||t.logout()})}[Symbol.for("uppy test: updateTotalProgress")](){return E(this,Y)[Y]()}updateOnlineStatus(){var e;null==(e=window.navigator.onLine)||e?(this.emit("is-online"),this.wasOffline&&(this.emit("back-online"),this.info(this.i18n("connectedToInternet"),"success",3e3),this.wasOffline=!1)):(this.emit("is-offline"),this.info(this.i18n("noInternetConnection"),"error",0),this.wasOffline=!0)}getID(){return this.opts.id}use(e){if("function"!=typeof e)throw TypeError(`Expected a plugin class, but got ${null===e?"null":typeof e}. Please verify that the plugin was imported and spelled correctly.`);for(var t=arguments.length,i=Array(t>1?t-1:0),s=1;s<t;s++)i[s-1]=arguments[s];let r=new e(this,...i),o=r.id;if(!o)throw Error("Your plugin must have an id");if(!r.type)throw Error("Your plugin must have a type");let a=this.getPlugin(o);if(a)throw Error(`Already found a plugin named '${a.id}'. Tried to use: '${o}'.
Uppy plugins must have unique \`id\` options.`);return e.VERSION&&this.log(`Using ${o} v${e.VERSION}`),r.type in E(this,R)[R]?E(this,R)[R][r.type].push(r):E(this,R)[R][r.type]=[r],r.install(),this.emit("plugin-added",r),this}getPlugin(e){for(let t of Object.values(E(this,R)[R])){let i=t.find(t=>t.id===e);if(null!=i)return i}}[Symbol.for("uppy test: getPlugins")](e){return E(this,R)[R][e]}iteratePlugins(e){Object.values(E(this,R)[R]).flat(1).forEach(e)}removePlugin(e){this.log(`Removing plugin ${e.id}`),this.emit("plugin-remove",e),e.uninstall&&e.uninstall();let t=E(this,R)[R][e.type],i=t.findIndex(t=>t.id===e.id);-1!==i&&t.splice(i,1);let s={plugins:{...this.getState().plugins,[e.id]:void 0}};this.setState(s)}destroy(){this.log(`Closing Uppy instance ${this.opts.id}: removing all files and uninstalling plugins`),this.cancelAll(),E(this,T)[T](),this.iteratePlugins(e=>{this.removePlugin(e)}),"undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener("online",E(this,J)[J]),window.removeEventListener("offline",E(this,J)[J]))}hideInfo(){let{info:e}=this.getState();this.setState({info:e.slice(1)}),this.emit("info-hidden")}info(e,t,i){void 0===t&&(t="info"),void 0===i&&(i=3e3);let s="object"==typeof e;this.setState({info:[...this.getState().info,{type:t,message:s?e.message:e,details:s?e.details:null}]}),setTimeout(()=>this.hideInfo(),i),this.emit("info-visible")}log(e,t){let{logger:i}=this.opts;switch(t){case"error":i.error(e);break;case"warning":i.warn(e);break;default:i.debug(e)}}registerRequestClient(e,t){E(this,Q)[Q].set(e,t)}getRequestClientForFile(e){if(!e.remote)throw Error(`Tried to get RequestClient for a non-remote file ${e.id}`);let t=E(this,Q)[Q].get(e.remote.requestClientId);if(null==t)throw Error(`requestClientId "${e.remote.requestClientId}" not registered for file "${e.id}"`);return t}restore(e){return(this.log(`Core: attempting to restore upload "${e}"`),this.getState().currentUploads[e])?E(this,es)[es](e):(E(this,ei)[ei](e),Promise.reject(Error("Nonexistent upload")))}[Symbol.for("uppy test: createUpload")](){return E(this,ee)[ee](...arguments)}addResultData(e,t){if(!E(this,et)[et](e))return void this.log(`Not setting result for an upload that has been removed: ${e}`);let{currentUploads:i}=this.getState(),s={...i[e],result:{...i[e].result,...t}};this.setState({currentUploads:{...i,[e]:s}})}async upload(){var e;null!=(e=E(this,R)[R].uploader)&&e.length||this.log("No uploader type plugins are used","warning");let{files:t}=this.getState();if(E(this,X)[X]().length>0){let e=await E(this,G)[G]();if(!(this.getFiles().filter(e=>null==e.progress.uploadStarted).length>0))return this.emit("complete",e),e;({files:t}=this.getState())}let i=this.opts.onBeforeUpload(t);return!1===i?Promise.reject(Error("Not starting the upload because onBeforeUpload returned false")):(i&&"object"==typeof i&&(t=i,this.setState({files:t})),Promise.resolve().then(()=>E(this,x)[x].validateMinNumberOfFiles(t)).catch(e=>{throw E(this,_)[_]([e]),e}).then(()=>{if(!E(this,N)[N](t))throw new F(this.i18n("missingRequiredMetaField"))}).catch(e=>{throw e}).then(async()=>{let{currentUploads:e}=this.getState(),i=Object.values(e).flatMap(e=>e.fileIDs),s=[];Object.keys(t).forEach(e=>{let t=this.getFile(e);t.progress.uploadStarted||-1!==i.indexOf(e)||s.push(t.id)});let r=E(this,ee)[ee](s),o=await E(this,es)[es](r);return this.emit("complete",o),o}).catch(e=>{throw this.emit("error",e),this.log(e,"error"),e}))}}function eo(e){for(let t of e)t.isRestriction?this.emit("restriction-failed",t.file,t):this.emit("error",t,t.file),this.log(t,"warning");let t=e.filter(e=>e.isUserFacing),i=t.slice(0,4),s=t.slice(4);i.forEach(e=>{let{message:t,details:i=""}=e;this.info({message:t,details:i},"error",this.opts.infoTimeout)}),s.length>0&&this.info({message:this.i18n("additionalRestrictionsFailed",{count:s.length})})}function ea(e){let{missingFields:t,error:i}=E(this,x)[x].getMissingRequiredMetaFields(e);return t.length>0?(this.setFileState(e.id,{missingRequiredMetaFields:t}),this.log(i.message),this.emit("restriction-failed",e,i),!1):(0===t.length&&e.missingRequiredMetaFields&&this.setFileState(e.id,{missingRequiredMetaFields:[]}),!0)}function el(e){let t=!0;for(let i of Object.values(e))E(this,L)[L](i)||(t=!1);return t}function en(e){let{allowNewUpload:t}=this.getState();if(!1===t){let t=new F(this.i18n("noMoreFilesAllowed"),{file:e});throw E(this,_)[_]([t]),t}}function eu(e){let t=e instanceof File?{name:e.name,type:e.type,size:e.size,data:e}:e,i=g(t),s=t.name?t.name:"image"===i.split("/")[0]?`${i.split("/")[0]}.${i.split("/")[1]}`:"noname",r=c(s).extension,o=function(e,t){var i;let s;if(e.isRemote&&e.remote&&new Set(["box","dropbox","drive","facebook","unsplash"]).has(e.remote.provider))return e.id;let r=g(e);return i={...e,type:r},s=t||"uppy","string"==typeof i.name&&(s+=`-${m(i.name.toLowerCase())}`),void 0!==i.type&&(s+=`-${i.type}`),i.meta&&"string"==typeof i.meta.relativePath&&(s+=`-${m(i.meta.relativePath.toLowerCase())}`),void 0!==i.data.size&&(s+=`-${i.data.size}`),void 0!==i.data.lastModified&&(s+=`-${i.data.lastModified}`),s}(t,this.getID()),a=t.meta||{};a.name=s,a.type=i;let l=Number.isFinite(t.data.size)?t.data.size:null;return{source:t.source||"",id:o,name:s,extension:r||"",meta:{...this.getState().meta,...a},type:i,data:t.data,progress:{percentage:0,bytesUploaded:!1,bytesTotal:l,uploadComplete:!1,uploadStarted:null},size:l,isGhost:!1,isRemote:t.isRemote||!1,remote:t.remote,preview:t.preview}}function ed(){this.opts.autoProceed&&!this.scheduledAutoProceed&&(this.scheduledAutoProceed=setTimeout(()=>{this.scheduledAutoProceed=null,this.upload().catch(e=>{e.isRestriction||this.log(e.stack||e.message||e)})},4))}function eh(e){let{files:t}=this.getState(),i={...t},s=[],r=[];for(let l of e)try{var o,a;let e=E(this,D)[D](l),r=null==(o=t[e.id])?void 0:o.isGhost;r&&(e={...t[e.id],isGhost:!1,data:l.data},this.log(`Replaced the blob in the restored ghost file: ${e.name}, ${e.id}`));let n=this.opts.onBeforeFileAdded(e,i);if(!n&&this.checkIfFileAlreadyExists(e.id))throw new F(this.i18n("noDuplicates",{fileName:null!=(a=e.name)?a:this.i18n("unnamed")}),{file:l});if(!1!==n||r)"object"==typeof n&&null!==n&&(e=n);else throw new F("Cannot add the file because onBeforeFileAdded returned false.",{isUserFacing:!1,file:l});E(this,x)[x].validateSingleFile(e),i[e.id]=e,s.push(e)}catch(e){r.push(e)}try{E(this,x)[x].validateAggregateRestrictions(Object.values(t),s)}catch(e){return r.push(e),{nextFilesState:t,validFilesToAdd:[],errors:r}}return{nextFilesState:i,validFilesToAdd:s,errors:r}}function ep(){let{files:e}=this.getState();return Object.keys(e).filter(t=>e[t].error)}async function ec(){let e=E(this,X)[X](),t={...this.getState().files};if(e.forEach(e=>{t[e]={...t[e],isPaused:!1,error:null}}),this.setState({files:t,error:null}),this.emit("retry-all",this.getFilesByIds(e)),0===e.length)return{successful:[],failed:[]};let i=E(this,ee)[ee](e,{forceAllowNewUpload:!0});return E(this,es)[es](i)}function ef(){var e,t;let i=E(this,V)[V](),s=null;null!=i&&((s=Math.round(100*i))>100?s=100:s<0&&(s=0)),this.emit("progress",null!=(e=s)?e:0),this.setState({totalProgress:null!=(t=s)?t:0})}function eg(){let e=this.getFiles().filter(e=>e.progress.uploadStarted||e.progress.preprocess||e.progress.postprocess);if(0===e.length)return 0;if(e.every(e=>e.progress.uploadComplete))return 1;let t=e=>null!=e.progress.bytesTotal&&0!==e.progress.bytesTotal,i=e.filter(t),s=e.filter(e=>!t(e));if(i.every(e=>e.progress.uploadComplete)&&s.length>0&&!s.every(e=>e.progress.uploadComplete))return null;let r=i.reduce((e,t)=>{var i;return e+(null!=(i=t.progress.bytesTotal)?i:0)},0),o=i.reduce((e,t)=>e+(t.progress.bytesUploaded||0),0);return 0===r?0:o/r}function em(){let e=(e,t,i)=>{let s=e.message||"Unknown error";e.details&&(s+=` ${e.details}`),this.setState({error:s}),null!=t&&t.id in this.getState().files&&this.setFileState(t.id,{error:s,response:i})};this.on("error",e),this.on("upload-error",(t,i,s)=>{if(e(i,t,s),"object"==typeof i&&i.message){var r;this.log(i.message,"error");let e=Error(this.i18n("failedToUpload",{file:null!=(r=null==t?void 0:t.name)?r:""}));e.isUserFacing=!0,e.details=i.message,i.details&&(e.details+=` ${i.details}`),E(this,_)[_]([e])}else E(this,_)[_]([i])});let t=null;this.on("upload-stalled",(e,i)=>{let{message:s}=e,r=i.map(e=>e.meta.name).join(", ");t||(this.info({message:s,details:r},"warning",this.opts.infoTimeout),t=setTimeout(()=>{t=null},this.opts.infoTimeout)),this.log(`${s} ${r}`.trim(),"warning")}),this.on("upload",()=>{this.setState({error:null})});let i=e=>{let t=Object.fromEntries(e.filter(e=>{let t=null!=e&&this.getFile(e.id);return t||this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`),t}).map(e=>[e.id,{progress:{uploadStarted:Date.now(),uploadComplete:!1,bytesUploaded:0,bytesTotal:e.size}}]));this.patchFilesState(t)};this.on("upload-start",i),this.on("upload-progress",E(this,W)[W]),this.on("upload-success",(e,t)=>{if(null==e||!this.getFile(e.id))return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);let i=this.getFile(e.id).progress;this.setFileState(e.id,{progress:{...i,postprocess:E(this,z)[z].size>0?{mode:"indeterminate"}:void 0,uploadComplete:!0,percentage:100,bytesUploaded:i.bytesTotal},response:t,uploadURL:t.uploadURL,isPaused:!1}),null==e.size&&this.setFileState(e.id,{size:t.bytesUploaded||i.bytesTotal}),E(this,Z)[Z]()}),this.on("preprocess-progress",(e,t)=>{if(null==e||!this.getFile(e.id))return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);this.setFileState(e.id,{progress:{...this.getFile(e.id).progress,preprocess:t}})}),this.on("preprocess-complete",e=>{if(null==e||!this.getFile(e.id))return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);let t={...this.getState().files};t[e.id]={...t[e.id],progress:{...t[e.id].progress}},delete t[e.id].progress.preprocess,this.setState({files:t})}),this.on("postprocess-progress",(e,t)=>{if(null==e||!this.getFile(e.id))return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);this.setFileState(e.id,{progress:{...this.getState().files[e.id].progress,postprocess:t}})}),this.on("postprocess-complete",e=>{if(null==e||!this.getFile(e.id))return void this.log(`Not setting progress for a file that has been removed: ${null==e?void 0:e.id}`);let t={...this.getState().files};t[e.id]={...t[e.id],progress:{...t[e.id].progress}},delete t[e.id].progress.postprocess,this.setState({files:t})}),this.on("restored",()=>{E(this,Z)[Z]()}),this.on("dashboard:file-edit-complete",e=>{e&&E(this,L)[L](e)}),"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("online",E(this,J)[J]),window.addEventListener("offline",E(this,J)[J]),setTimeout(E(this,J)[J],3e3))}function ey(e,t){void 0===t&&(t={});let{forceAllowNewUpload:i=!1}=t,{allowNewUpload:s,currentUploads:r}=this.getState();if(!s&&!i)throw Error("Cannot create a new upload: already uploading.");let o=((e=21)=>{let t="",i=0|e;for(;i--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return t})();return this.emit("upload",o,this.getFilesByIds(e)),this.setState({allowNewUpload:!1!==this.opts.allowMultipleUploadBatches&&!1!==this.opts.allowMultipleUploads,currentUploads:{...r,[o]:{fileIDs:e,step:0,result:{}}}}),o}function ev(e){let{currentUploads:t}=this.getState();return t[e]}function eb(e){let t={...this.getState().currentUploads};delete t[e],this.setState({currentUploads:t})}async function ew(e){let t,i=()=>{let{currentUploads:t}=this.getState();return t[e]},s=i(),r=[...E(this,M)[M],...E(this,I)[I],...E(this,z)[z]];try{for(let t=s.step||0;t<r.length&&s;t++){let o=r[t];this.setState({currentUploads:{...this.getState().currentUploads,[e]:{...s,step:t}}});let{fileIDs:a}=s;await o(a,e),s=i()}}catch(t){throw E(this,ei)[ei](e),t}if(s){s.fileIDs.forEach(e=>{let t=this.getFile(e);t&&t.progress.postprocess&&this.emit("postprocess-complete",t)});let t=s.fileIDs.map(e=>this.getFile(e)),r=t.filter(e=>!e.error),o=t.filter(e=>e.error);this.addResultData(e,{successful:r,failed:o,uploadID:e}),s=i()}return s&&(t=s.result,E(this,ei)[ei](e)),null==t&&(this.log(`Not setting result for an upload that has been removed: ${e}`),t={successful:[],failed:[],uploadID:e}),t}er.VERSION="4.4.7";let eP=er},59905:function(e,t,i){function s(e,t){if(!({}).hasOwnProperty.call(e,t))throw TypeError("attempted to use private field on non-instance");return e}i.d(t,{Z:()=>d});var r=0;function o(e){return"__private_"+r+++"_"+e}function a(e,t){let i=/\$/g,s=[e];if(null==t)return s;for(let e of Object.keys(t))if("_"!==e){let r=t[e];"string"==typeof r&&(r=i[Symbol.replace](r,"$$$$")),s=function(e,t,i){let s=[];return e.forEach(e=>"string"!=typeof e?s.push(e):t[Symbol.split](e).forEach((e,t,r)=>{""!==e&&s.push(e),t<r.length-1&&s.push(i)})),s}(s,RegExp(`%\\{${e}\\}`,"g"),r)}return s}let l=e=>{throw Error(`missing string: ${e}`)};var n=o("onMissingKey"),u=o("apply");class d{constructor(e,t){let{onMissingKey:i=l}=void 0===t?{}:t;Object.defineProperty(this,u,{value:h}),Object.defineProperty(this,n,{writable:!0,value:void 0}),this.locale={strings:{},pluralize:e=>+(1!==e)},Array.isArray(e)?e.forEach(s(this,u)[u],this):s(this,u)[u](e),s(this,n)[n]=i}translate(e,t){return this.translateArray(e,t).join("")}translateArray(e,t){let i=this.locale.strings[e];if(null==i&&(s(this,n)[n](e),i=e),"object"==typeof i){if(t&&void 0!==t.smart_count)return a(i[this.locale.pluralize(t.smart_count)],t);throw Error("Attempted to use a string with plural forms, but no value was given for %{smart_count}")}if("string"!=typeof i)throw Error("string was not a string");return a(i,t)}}function h(e){if(!(null!=e&&e.strings))return;let t=this.locale;Object.assign(this.locale,{strings:{...t.strings,...e.strings},pluralize:e.pluralize||t.pluralize})}}}]);
//# sourceMappingURL=/packs/js/8089-f3085c816266a180.js.map